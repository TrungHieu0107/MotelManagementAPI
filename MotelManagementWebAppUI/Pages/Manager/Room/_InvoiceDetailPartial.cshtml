@using BussinessObject.DTO
@using System.Globalization
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{

    var waterConsume = Model.WaterConsumptionEnd - Model.WaterConsumptionStart;
    var totalWaterCost = waterConsume * Model.WaterCost?.Price;

    var electricityConsume = Model.ElectricityConsumptionEnd - Model.ElectricityConsumptionStart;
    var totalElectricCost = electricityConsume * Model.ElectricityCost?.Price;

    var dayUse = (int)(Model.EndDate.Value - Model.StartDate).TotalDays;
    var totalRentFee = dayUse * Model.Room.RentFee;

    var totalInvoice = totalElectricCost + totalWaterCost + totalRentFee;

    var idInvoice = Model.Id;
    var idResident = Model.Resident.Id;
}

@model InvoiceDTO

<div>
        <div><h3>Thông tin hóa đơn</h3></div>
        <div class="row">
            <b class="col-2">Phòng trọ: </b>
            <span class="col-10">
                Phòng @Model.Room.Code - @Model.Room.MotelChain.Name - @Model.Room.MotelChain.Address
            </span>
        </div>

        <div class="row">
            <b class="col-2">@Html.DisplayNameFor(Model => Model.Resident.FullName):  </b>
            <span class="col-3">@Model.Resident.FullName</span>

            <b class="col-2">@Html.DisplayNameFor(Model => Model.Resident.Phone):  </b>
            <span class="col-3">@Model.Resident.Phone</span>
        </div>
        <div class="row">
            <b class="col-2">@Html.DisplayNameFor(Model => Model.Room.MotelChain.Manager.FullName):  </b>
            <span class="col-3">@Model.Room.MotelChain.Manager.FullName</span>
            <b class="col-2">@Html.DisplayNameFor(Model => Model.Room.MotelChain.Manager.Phone):  </b>
            <span class="col-3">@Model.Room.MotelChain.Manager.Phone</span>
        </div>
        <div class="row">
            <b class="col-2">@Html.DisplayNameFor(Model => Model.StartDate):  </b>
            <span class="col-3">@Model.StartDate.ToString("dd/MM/yyyy HH:mm", CultureInfo.InvariantCulture)</span>

            <b class="col-2">@Html.DisplayNameFor(Model => Model.EndDate):  </b>
            <span class="col-3">@Model.EndDate.Value.ToString("dd/MM/yyyy HH:mm", CultureInfo.InvariantCulture)</span>
        </div>
        <div class="row">
            <b class="col-2">@Html.DisplayNameFor(Model => Model.CreatedDate):  </b>
            <span class="col-3">
                @Model.CreatedDate.ToString("dd/MM/yyyy HH:mm", CultureInfo.InvariantCulture)
            </span>

            <b class="col-2">@Html.DisplayNameFor(Model => Model.ExpiredDate):  </b>
            <span class="col-3">
                @Model.ExpiredDate.Value.ToString("dd/MM/yyyy HH:mm", CultureInfo.InvariantCulture)
            </span>
        </div>
        <div><b>@Html.DisplayNameFor(Model => Model.PaidDate):  </b>@Model.PaidDate.Value.ToString("dd/MM/yyyy HH:mm", CultureInfo.InvariantCulture)</div>

        <b>Tiền điện</b>
        <table class="table table-bordered">
            <thead style="background-color:gray" class="text-white">
                <tr>
                    <th>
                        @Html.DisplayNameFor(Model => Model.ElectricityConsumptionStart)
                    </th>
                    <th>
                        @Html.DisplayNameFor(Model => Model.ElectricityConsumptionEnd)
                    </th>
                    <th>
                        Lượng tiêu thụ
                    </th>
                    <th>
                        @Html.DisplayNameFor(Model => Model.ElectricityCost.Price)
                    </th>
                    <th>
                        Tổng tiền điện
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        @Model.ElectricityConsumptionStart kWh
                    </td>
                    <td>
                        @Model.ElectricityConsumptionEnd kWh
                    </td>
                    <td>
                        @electricityConsume kWh
                    </td>
                    <td>
                        @Model.ElectricityCost.Price VNĐ/kWh
                    </td>
                    <td>
                        @totalElectricCost VNĐ
                    </td>
                </tr>
            </tbody>
        </table>

        <b>Tiền nước</b>
        <table class="table table-bordered">
            <thead style="position: sticky; top: 0; z-index: 999; background-color:gray" class="text-white">
                <tr>
                    <th>
                        @Html.DisplayNameFor(Model => Model.WaterConsumptionStart)
                    </th>
                    <th>
                        @Html.DisplayNameFor(Model => Model.WaterConsumptionEnd)
                    </th>
                    <th>
                        Lượng tiêu thụ
                    </th>
                    <th>
                        @Html.DisplayNameFor(Model => Model.WaterCost.Price)
                    </th>
                    <th>
                        Tổng tiền nước
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        @Model.WaterConsumptionStart m3
                    </td>
                    <td>
                        @Model.WaterConsumptionEnd m3
                    </td>
                    <td>
                        @waterConsume m3
                    </td>
                    <td>
                        @Model.WaterCost.Price VNĐ/m3
                    </td>
                    <td>
                        @totalWaterCost VNĐ
                    </td>
                </tr>
            </tbody>
        </table>

        <b>Tiền phòng</b>
        <table class="table table-bordered">
            <thead style="position: sticky; top: 0; z-index: 999; background-color:gray" class="text-white">
                <tr>
                    <th>
                        @Html.DisplayNameFor(Model => Model.StartDate)
                    </th>
                    <th>
                        @Html.DisplayNameFor(Model => Model.EndDate)
                    </th>
                    <th>
                        Số ngày ở
                    </th>
                    <th>
                        @Html.DisplayNameFor(Model => Model.Room.RentFee)
                    </th>
                    <th>
                        Tổng tiền phòng
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        @Model.StartDate.ToString("dd/MM/yyyy HH:mm", CultureInfo.InvariantCulture)
                    </td>
                    <td>
                        @Model.EndDate.Value.ToString("dd/MM/yyyy HH:mm", CultureInfo.InvariantCulture)
                    </td>
                    <td>
                        @dayUse ngày
                    </td>
                    <td>
                        @Model.Room.RentFee VNĐ/ngày
                    </td>
                    <td>
                        @totalRentFee VNĐ
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="row">
            <b class="col-2">Tổng: </b>
            <span class="col-5" id="total-invoice">@totalInvoice VNĐ</span>
        </div>
    </div>
